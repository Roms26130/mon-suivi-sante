<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Health Tracker Pro v3.1</title>
    
    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; }
        .drop-anim { transition: all 0.2s ease; }
        .drop-anim:active { transform: scale(0.9); }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- Utilitaire Stockage S√©curis√© ---
        const safeStorage = {
            getItem: (key) => {
                try { return localStorage.getItem(key); } 
                catch (e) { console.warn("Stockage inaccessible", e); return null; }
            },
            setItem: (key, value) => {
                try { localStorage.setItem(key, value); } 
                catch (e) { console.warn("√âcriture impossible", e); }
            },
            removeItem: (key) => {
                try { localStorage.removeItem(key); }
                catch (e) { console.warn("Suppression impossible", e); }
            }
        };

        // --- Ic√¥nes ---
        const Icons = {
            Activity: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>,
            Settings: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.09a2 2 0 0 1-1-1.74v-.47a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>,
            ClipboardCopy: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="8" height="4" x="8" y="2" rx="1" ry="1"/><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/></svg>,
            Sun: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="5"/><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/></svg>,
            Moon: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/></svg>,
            Coffee: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M17 8h1a4 4 0 1 1 0 8h-1"/><path d="M3 8h14v9a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4Z"/><line x1="6" x2="6" y1="1" y2="4"/><line x1="10" x2="10" y1="1" y2="4"/><line x1="14" x2="14" y1="1" y2="4"/></svg>,
            CheckCircle2: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>,
            AlertCircle: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="12"/><line x1="12" x2="12.01" y1="16" y2="16"/></svg>,
            ChevronLeft: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="15 18 9 12 15 6"/></svg>,
            ChevronRight: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="9 18 15 12 9 6"/></svg>,
            PlusCircle: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="16"/><line x1="8" x2="16" y1="12" y2="12"/></svg>,
            Trash2: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>,
            Plus: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="12" x2="12" y1="5" y2="19"/><line x1="5" x2="19" y1="12" y2="12"/></svg>,
            BarChart: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="18" y1="20" x2="18" y2="10"></line><line x1="12" y1="20" x2="12" y2="4"></line><line x1="6" y1="20" x2="6" y2="14"></line></svg>,
            Lock: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="18" height="11" x="3" y="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>,
            User: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>,
            Dumbbell: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m6.5 6.5 11 11"/><path d="m21 21-1-1"/><path d="m3 3 1 1"/><path d="m18 22 4-4"/><path d="m2 6 4-4"/><path d="m3 10 7.9-7.9a2.121 2.121 0 0 1 3 3L6 12.9a2.121 2.121 0 0 1-3-3Z"/><path d="m12.9 6 7.9 7.9a2.121 2.121 0 0 1-3 3L10 9a2.121 2.121 0 0 1 2.9-3Z"/></svg>,
            Droplets: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M7 16.3c2.2 0 4-1.83 4-4.05 0-1.16-.57-2.26-1.71-3.19S7.29 6.75 7 5.3c-.29 1.45-1.14 2.8-2.29 3.76S3 11.1 3 12.25c0 2.22 1.8 4.05 4 4.05z"/><path d="M12.56 6.6A10.97 10.97 0 0 0 14 3.02c.5 2.5 2 4.9 4 6.5s3 3.5 3 5.5a6.98 6.98 0 0 1-11.91 4.97"/></svg>,
            Bed: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M2 4v16"/><path d="M2 8h18a2 2 0 0 1 2 2v10"/><path d="M2 17h20"/><path d="M6 8v9"/></svg>,
            LogOut: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" x2="9" y1="12" y2="12"/></svg>
        };

        const Card = ({ children, className = "" }) => (
            <div className={`bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden ${className}`}>
                {children}
            </div>
        );

        const Badge = ({ children, color = "slate" }) => {
            const colors = {
                slate: "bg-slate-100 text-slate-700",
                green: "bg-emerald-100 text-emerald-700",
                red: "bg-rose-100 text-rose-700",
                blue: "bg-blue-100 text-blue-700",
                indigo: "bg-indigo-100 text-indigo-700",
                amber: "bg-amber-100 text-amber-700",
                cyan: "bg-cyan-100 text-cyan-700"
            };
            return (
                <span className={`px-2 py-0.5 rounded text-[10px] font-bold uppercase tracking-wide ${colors[color] || colors.slate}`}>
                    {children}
                </span>
            );
        };

        // --- Donn√©es par d√©faut ---
        const DEFAULT_SUPPLEMENTS = [
            { id: 't4', name: 'L√©vothyrox', dosage: '100 ¬µg', time: 'matin' },
            { id: 'glu', name: 'L-Glutamine', dosage: '5g', time: 'matin' },
            { id: 'multi', name: 'Multivitamines', dosage: '1 g√©lule', time: 'midi' },
            { id: 'o3', name: 'Om√©ga-3', dosage: '1000 mg', time: 'midi' },
            { id: 'mg', name: 'Magn√©sium', dosage: '300 mg', time: 'soir' },
            { id: 'ash', name: 'Ashwagandha', dosage: 'KSM-66', time: 'soir' },
        ];

        const DEFAULT_METRICS = [
            { id: 'energie', label: '√ânergie' },
            { id: 'moral', label: 'Moral' },
            { id: 'digestion', label: 'Digestion' },
            { id: 'stress', label: 'Stress' }
        ];
        
        const ACTIVITY_TYPES = ['Marche', 'Course √† pied', 'Musculation', 'V√©lo', 'Yoga', 'Natation', 'Autre'];

        const DAYS = ['Lundi', 'Mardi', 'Mercredi', 'Jeudi', 'Vendredi', 'Samedi', 'Dimanche'];

        const INITIAL_DAY_DATA = {
            supplements: {}, 
            repasOk: { matin: false, midi: false, soir: false },
            metrics: {}, 
            hydration: 0, 
            sleep: { hours: '', quality: '' }, 
            activities: [], 
            notes: ''
        };

        const getWeekDates = (offsetWeeks = 0) => {
            const today = new Date();
            const first = today.getDate() - today.getDay() + 1 + (offsetWeeks * 7);
            const start = new Date(today.setDate(first));
            const end = new Date(today.setDate(first + 6));
            return {
                startStr: start.toLocaleDateString('fr-FR'),
                endStr: end.toLocaleDateString('fr-FR'),
                id: start.toISOString().split('T')[0] 
            };
        };

        // --- Composant d'Authentification ---
        const AuthScreen = ({ onLogin }) => {
            const [mode, setMode] = useState('login'); 
            const [username, setUsername] = useState('');
            const [password, setPassword] = useState('');
            const [error, setError] = useState('');

            useEffect(() => {
                const storedAuth = safeStorage.getItem('sante_auth_config');
                if (!storedAuth) setMode('setup');
            }, []);

            const handleAuth = (e) => {
                e.preventDefault();
                setError('');
                if (mode === 'setup') {
                    if (username.length < 3 || password.length < 4) {
                        setError("Le nom doit faire 3+ caract√®res et le mot de passe 4+.");
                        return;
                    }
                    safeStorage.setItem('sante_auth_config', JSON.stringify({ username, password }));
                    onLogin(username);
                } else {
                    const stored = JSON.parse(safeStorage.getItem('sante_auth_config'));
                    if (stored && stored.username === username && stored.password === password) {
                        onLogin(username);
                    } else {
                        setError("Identifiants incorrects.");
                    }
                }
            };

            return (
                <div className="min-h-screen bg-slate-900 flex items-center justify-center p-4">
                    <Card className="w-full max-w-md p-8">
                        <div className="text-center mb-6">
                            <div className="bg-indigo-600 w-12 h-12 rounded-lg flex items-center justify-center mx-auto mb-4 text-white">
                                <Icons.Lock size={24} />
                            </div>
                            <h1 className="text-2xl font-bold text-slate-800">
                                {mode === 'setup' ? 'Cr√©ation de compte local' : 'Connexion S√©curis√©e'}
                            </h1>
                            <p className="text-sm text-slate-500 mt-2">
                                {mode === 'setup' 
                                    ? "D√©finissez vos identifiants pour s√©curiser l'acc√®s √† vos donn√©es sur cet appareil." 
                                    : "Veuillez vous identifier pour acc√©der √† votre suivi sant√©."}
                            </p>
                        </div>
                        <form onSubmit={handleAuth} className="space-y-4">
                            <div>
                                <label className="block text-sm font-medium text-slate-700 mb-1">Nom d'utilisateur</label>
                                <div className="relative">
                                    <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-slate-400">
                                        <Icons.User size={16} />
                                    </div>
                                    <input type="text" value={username} onChange={(e) => setUsername(e.target.value)} className="pl-10 block w-full rounded-md border-slate-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 border p-2" placeholder="Votre nom" />
                                </div>
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-slate-700 mb-1">Mot de passe</label>
                                <div className="relative">
                                    <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-slate-400">
                                        <Icons.Lock size={16} />
                                    </div>
                                    <input type="password" value={password} onChange={(e) => setPassword(e.target.value)} className="pl-10 block w-full rounded-md border-slate-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 border p-2" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
                                </div>
                            </div>
                            {error && <div className="text-red-500 text-xs text-center">{error}</div>}
                            <button type="submit" className="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                {mode === 'setup' ? 'Cr√©er et Acc√©der' : 'Se Connecter'}
                            </button>
                        </form>
                    </Card>
                </div>
            );
        };

        // --- Application Principale ---
        function App() {
            const [isAuthenticated, setIsAuthenticated] = useState(false);
            const [currentUser, setCurrentUser] = useState('');
            const [activeTab, setActiveTab] = useState('tracker'); 

            const [configSupplements, setConfigSupplements] = useState(() => JSON.parse(safeStorage.getItem('sante_config_supplements_v3') || JSON.stringify(DEFAULT_SUPPLEMENTS)));
            const [configMetrics, setConfigMetrics] = useState(() => JSON.parse(safeStorage.getItem('sante_config_metrics_v3') || JSON.stringify(DEFAULT_METRICS)));
            const [weeksList, setWeeksList] = useState(() => {
                const saved = safeStorage.getItem('sante_weeks_list');
                if (saved) return JSON.parse(saved);
                const current = getWeekDates();
                return [{ id: current.id, label: `Semaine du ${current.startStr} au ${current.endStr}`, objective: "" }];
            });
            const [activeWeekId, setActiveWeekId] = useState(() => {
                const savedList = safeStorage.getItem('sante_weeks_list');
                return savedList ? JSON.parse(savedList).slice(-1)[0].id : getWeekDates().id;
            });
            const [allWeeksData, setAllWeeksData] = useState(() => {
                const saved = safeStorage.getItem('sante_all_weeks_data_v3');
                if (saved) return JSON.parse(saved);
                const current = getWeekDates();
                const initialWeek = {};
                DAYS.forEach(day => { initialWeek[day] = JSON.parse(JSON.stringify(INITIAL_DAY_DATA)); });
                return { [current.id]: { days: initialWeek, review: { victories: '', adjustments: '' } } };
            });

            useEffect(() => {
                if (isAuthenticated) {
                    safeStorage.setItem('sante_config_supplements_v3', JSON.stringify(configSupplements));
                    safeStorage.setItem('sante_config_metrics_v3', JSON.stringify(configMetrics));
                    safeStorage.setItem('sante_weeks_list', JSON.stringify(weeksList));
                    safeStorage.setItem('sante_all_weeks_data_v3', JSON.stringify(allWeeksData));
                }
            }, [configSupplements, configMetrics, weeksList, allWeeksData, isAuthenticated]);

            const currentWeekData = allWeeksData[activeWeekId] || { days: {}, review: {} };
            const currentWeekMeta = weeksList.find(w => w.id === activeWeekId) || weeksList[0];
            const currentIndex = weeksList.findIndex(w => w.id === activeWeekId);

            const updateDayData = (day, field, value, subField = null) => {
                setAllWeeksData(prev => {
                    const week = prev[activeWeekId] ? { ...prev[activeWeekId] } : { days: {}, review: {} };
                    const dayData = week.days[day] ? { ...week.days[day] } : JSON.parse(JSON.stringify(INITIAL_DAY_DATA));
                    if (subField) dayData[field] = { ...dayData[field], [subField]: value };
                    else dayData[field] = value;
                    week.days[day] = dayData;
                    return { ...prev, [activeWeekId]: week };
                });
            };

            const addActivity = (day, type, duration, calories, intensity) => {
                const newAct = { id: Date.now(), type, duration, calories, intensity };
                const currentActs = currentWeekData.days[day]?.activities || [];
                updateDayData(day, 'activities', [...currentActs, newAct]);
            };
            const removeActivity = (day, actId) => {
                const currentActs = currentWeekData.days[day]?.activities || [];
                updateDayData(day, 'activities', currentActs.filter(a => a.id !== actId));
            };
            const setHydration = (day, level) => updateDayData(day, 'hydration', level);
            const updateSleep = (day, field, value) => updateDayData(day, 'sleep', value, field);

            const createNewWeek = () => {
                const lastWeekId = weeksList[weeksList.length - 1].id;
                const lastDate = new Date(lastWeekId);
                lastDate.setDate(lastDate.getDate() + 7); 
                const nextStart = lastDate;
                const nextEnd = new Date(lastDate);
                nextEnd.setDate(nextEnd.getDate() + 6);
                const newWeekId = nextStart.toISOString().split('T')[0];
                const newWeekLabel = `Semaine du ${nextStart.toLocaleDateString('fr-FR')} au ${nextEnd.toLocaleDateString('fr-FR')}`;
                setWeeksList(prev => [...prev, { id: newWeekId, label: newWeekLabel, objective: '' }]);
                const emptyWeekData = {};
                DAYS.forEach(day => { emptyWeekData[day] = JSON.parse(JSON.stringify(INITIAL_DAY_DATA)); });
                setAllWeeksData(prev => ({ ...prev, [newWeekId]: { days: emptyWeekData, review: { victories: '', adjustments: '' } } }));
                setActiveWeekId(newWeekId);
            };

            const copyForAI = () => {
                let prompt = `Analyse mes donn√©es sant√©/sport pour la ${currentWeekMeta.label} (Utilisateur: ${currentUser}).\n`;
                prompt += `Objectif : ${currentWeekMeta.objective}\n\n`;
                DAYS.forEach(day => {
                    const data = currentWeekData.days[day] || INITIAL_DAY_DATA;
                    const suppsTaken = configSupplements.filter(s => data.supplements?.[s.id]).map(s => s.name).length;
                    prompt += `--- ${day.toUpperCase()} ---\n`;
                    prompt += `> PHYSIOLOGIE\n`;
                    prompt += `- Sommeil: ${data.sleep?.hours || '?'}h (Qualit√©: ${data.sleep?.quality || '?'}/5)\n`;
                    prompt += `- Hydratation: ${data.hydration || 0} verres\n`;
                    if (data.activities && data.activities.length > 0) {
                         prompt += `> SPORT\n`;
                         data.activities.forEach(act => {
                             prompt += `- ${act.type}: ${act.duration}min (${act.calories}kcal, Intensit√©: ${act.intensity})\n`;
                         });
                    }
                    prompt += `> RESSENTI\n`;
                    configMetrics.forEach(m => {
                        if(data.metrics?.[m.id]) prompt += `- ${m.label} : ${data.metrics[m.id]}/10\n`;
                    });
                    if (data.notes) prompt += `> NOTES: ${data.notes}\n`;
                    prompt += `\n`;
                });
                navigator.clipboard.writeText(prompt);
                alert("Donn√©es export√©es dans le presse-papier !");
            };

            const handleLogin = (user) => {
                setCurrentUser(user);
                setIsAuthenticated(true);
            };

            const handleLogout = () => {
                setIsAuthenticated(false);
                setCurrentUser('');
            };

            // Settings Actions
            const addSupplement = (name, dosage, time) => {
                const newSupp = { id: Date.now().toString(), name, dosage, time };
                setConfigSupplements([...configSupplements, newSupp]);
            };
            const removeSupplement = (id) => setConfigSupplements(configSupplements.filter(s => s.id !== id));
            const updateSupplementDosage = (id, newDosage) => setConfigSupplements(prev => prev.map(s => s.id === id ? { ...s, dosage: newDosage } : s));
            const addMetric = (label) => {
                const id = label.toLowerCase().replace(/[^a-z0-9]/g, '');
                setConfigMetrics([...configMetrics, { id: Date.now().toString(), label }]);
            };
            const removeMetric = (id) => setConfigMetrics(configMetrics.filter(m => m.id !== id));

            if (!isAuthenticated) return <AuthScreen onLogin={handleLogin} />;

            return (
                <div className="min-h-screen bg-slate-50 pb-20 font-sans text-slate-800">
                    <header className="bg-white border-b border-slate-200 sticky top-0 z-30 shadow-sm">
                        <div className="max-w-7xl mx-auto px-4 py-3">
                            <div className="flex justify-between items-center mb-4">
                                <div className="flex items-center gap-3">
                                    <div className="bg-indigo-600 p-2 rounded-lg text-white">
                                        <Icons.Activity size={24} />
                                    </div>
                                    <div className="hidden md:block">
                                        <h1 className="text-xl font-bold text-slate-900 leading-tight">Health Tracker Pro</h1>
                                        <p className="text-[10px] text-slate-500 uppercase tracking-wider font-bold">v3.1 ‚Ä¢ {currentUser}</p>
                                    </div>
                                </div>
                                <div className="flex gap-2">
                                    <button onClick={() => setActiveTab('tracker')} className={`px-3 py-2 rounded-lg text-sm font-medium transition-colors ${activeTab === 'tracker' ? 'bg-slate-800 text-white' : 'bg-slate-100 text-slate-600 hover:bg-slate-200'}`}>Journal</button>
                                    <button onClick={() => setActiveTab('settings')} className={`px-3 py-2 rounded-lg text-sm font-medium transition-colors flex items-center gap-2 ${activeTab === 'settings' ? 'bg-slate-800 text-white' : 'bg-slate-100 text-slate-600 hover:bg-slate-200'}`}>
                                        <Icons.Settings size={16} /> <span className="hidden md:inline">R√©glages</span>
                                    </button>
                                    <button onClick={copyForAI} className="px-3 py-2 rounded-lg text-sm font-medium bg-indigo-50 text-indigo-700 hover:bg-indigo-100 border border-indigo-200 flex items-center gap-2">
                                        <Icons.ClipboardCopy size={16} /> <span className="hidden md:inline">Export IA</span>
                                    </button>
                                    <button onClick={handleLogout} className="px-3 py-2 rounded-lg text-sm font-medium text-slate-500 hover:bg-slate-100 hover:text-red-500 flex items-center gap-2" title="D√©connexion">
                                        <Icons.LogOut size={16} />
                                    </button>
                                </div>
                            </div>

                            {activeTab === 'tracker' && (
                                <div className="flex items-center justify-between bg-slate-100 p-1 rounded-lg">
                                    <button onClick={() => { if(currentIndex > 0) setActiveWeekId(weeksList[currentIndex - 1].id) }} disabled={currentIndex === 0} className="p-2 rounded-md disabled:opacity-30 hover:bg-white"><Icons.ChevronLeft size={20}/></button>
                                    <div className="text-center">
                                        <h2 className="text-sm font-bold text-slate-800">{currentWeekMeta.label}</h2>
                                    </div>
                                    <div className="flex gap-1">
                                        <button onClick={() => { if(currentIndex < weeksList.length - 1) setActiveWeekId(weeksList[currentIndex + 1].id) }} disabled={currentIndex === weeksList.length - 1} className="p-2 rounded-md disabled:opacity-30 hover:bg-white"><Icons.ChevronRight size={20}/></button>
                                        <div className="w-px h-8 bg-slate-200 mx-1"></div>
                                        <button onClick={createNewWeek} className="px-3 py-1 bg-indigo-600 text-white rounded-md text-xs font-bold hover:bg-indigo-700 flex items-center gap-1"><Icons.PlusCircle size={14} /> Nouvelle</button>
                                    </div>
                                </div>
                            )}
                        </div>
                    </header>

                    <main className="max-w-[1600px] mx-auto px-4 py-6">
                        {activeTab === 'settings' && (
                            <div className="max-w-4xl mx-auto space-y-6">
                                <Card className="p-6">
                                    <h2 className="text-lg font-bold mb-4 flex items-center gap-2 border-b pb-4">
                                        <Icons.BarChart size={20} className="text-indigo-600"/>
                                        Configuration des Indicateurs
                                    </h2>
                                    <div className="space-y-3 mb-6">
                                        {configMetrics.map(metric => (
                                            <div key={metric.id} className="flex justify-between items-center bg-slate-50 p-3 rounded-lg border border-slate-200">
                                                <span className="font-medium text-slate-700">{metric.label}</span>
                                                <button onClick={() => removeMetric(metric.id)} className="text-slate-400 hover:text-rose-500 p-2">
                                                    <Icons.Trash2 size={16}/>
                                                </button>
                                            </div>
                                        ))}
                                    </div>
                                    <form onSubmit={(e) => { e.preventDefault(); const label = e.target.elements.label.value; if(label) { addMetric(label); e.target.reset(); }}} className="flex gap-2">
                                        <input name="label" placeholder="Nouvel indicateur (ex: Stress, Libido...)" className="flex-grow text-sm p-2 border border-slate-300 rounded shadow-sm" required />
                                        <button type="submit" className="bg-slate-800 text-white p-2 rounded shadow-sm hover:bg-slate-700 flex items-center gap-1 text-sm font-medium"><Icons.Plus size={16}/> Ajouter</button>
                                    </form>
                                </Card>

                                <Card className="p-6">
                                    <h2 className="text-lg font-bold mb-4 flex items-center gap-2 border-b pb-4">
                                        <Icons.Settings size={20} className="text-indigo-600"/>
                                        Configuration des Traitements
                                    </h2>
                                    <div className="space-y-8">
                                        {['matin', 'midi', 'soir'].map(time => (
                                            <div key={time}>
                                                <h3 className="font-bold capitalize text-slate-800 mb-3 flex items-center gap-2 text-lg">
                                                    {time === 'matin' && <div className="p-1.5 bg-blue-100 rounded text-blue-600"><Icons.Coffee size={18}/></div>}
                                                    {time === 'midi' && <div className="p-1.5 bg-amber-100 rounded text-amber-600"><Icons.Sun size={18}/></div>}
                                                    {time === 'soir' && <div className="p-1.5 bg-indigo-100 rounded text-indigo-600"><Icons.Moon size={18}/></div>}
                                                    {time}
                                                </h3>
                                                <div className="space-y-3">
                                                    {configSupplements.filter(s => s.time === time).map(supp => (
                                                        <div key={supp.id} className="flex flex-col md:flex-row md:items-center gap-2 bg-slate-50 p-3 rounded-lg border border-slate-200 shadow-sm">
                                                            <div className="flex-1 font-medium text-slate-700">{supp.name}</div>
                                                            <div className="flex items-center gap-2 w-full md:w-auto">
                                                                <label className="text-xs text-slate-400 uppercase font-bold">Dosage:</label>
                                                                <input type="text" value={supp.dosage || ''} onChange={(e) => updateSupplementDosage(supp.id, e.target.value)} className="w-24 text-sm p-1.5 border border-slate-300 rounded focus:border-indigo-500 outline-none" placeholder="ex: 10mg"/>
                                                                <button onClick={() => removeSupplement(supp.id)} className="p-2 text-slate-400 hover:text-rose-500 hover:bg-rose-50 rounded ml-1"><Icons.Trash2 size={16}/></button>
                                                            </div>
                                                        </div>
                                                    ))}
                                                </div>
                                                <form onSubmit={(e) => { e.preventDefault(); const name = e.target.elements.name.value; const dosage = e.target.elements.dosage.value; if(name) { addSupplement(name, dosage, time); e.target.reset(); }}} className="mt-4 flex gap-2 items-center">
                                                    <input name="name" placeholder="Nouveau traitement..." className="flex-grow text-sm p-2 border border-slate-300 rounded shadow-sm" required />
                                                    <input name="dosage" placeholder="Dosage" className="w-24 text-sm p-2 border border-slate-300 rounded shadow-sm" />
                                                    <button type="submit" className="bg-slate-800 text-white p-2 rounded shadow-sm hover:bg-slate-700 flex items-center gap-1 text-sm font-medium"><Icons.Plus size={16}/> Ajouter</button>
                                                </form>
                                            </div>
                                        ))}
                                    </div>
                                </Card>
                            </div>
                        )}

                        {activeTab === 'tracker' && (
                            <div className="space-y-6">
                                <div className="bg-white p-4 rounded-xl border border-indigo-100 shadow-sm flex flex-col md:flex-row gap-4 items-center">
                                    <div className="flex-1 w-full">
                                        <label className="text-xs text-indigo-500 uppercase font-bold tracking-wider mb-1 block">Objectif Hebdo</label>
                                        <input value={currentWeekMeta.objective} onChange={(e) => {
                                            const val = e.target.value;
                                            setWeeksList(prev => prev.map(w => w.id === activeWeekId ? { ...w, objective: val } : w));
                                        }} className="block w-full text-lg font-medium text-slate-700 bg-transparent outline-none" placeholder="Ex: Musculation 3x, Sommeil 8h..." />
                                    </div>
                                </div>

                                <Card className="overflow-x-auto">
                                    <table className="w-full text-sm text-left">
                                        <thead className="bg-slate-50 text-slate-500 uppercase text-xs font-bold border-b border-slate-200">
                                            <tr>
                                                <th className="px-4 py-3 min-w-[100px]">Jour</th>
                                                <th className="px-4 py-3 min-w-[200px] bg-blue-50/50">Hygi√®ne de vie</th>
                                                <th className="px-4 py-3 min-w-[300px] bg-orange-50/50">Sport & Activit√©</th>
                                                <th className="px-4 py-3 min-w-[150px] bg-indigo-50/50">Traitements</th>
                                                <th className="px-4 py-3 min-w-[200px]">Indicateurs</th>
                                                <th className="px-4 py-3 min-w-[200px]">Notes</th>
                                            </tr>
                                        </thead>
                                        <tbody className="divide-y divide-slate-100">
                                            {DAYS.map((day) => {
                                                const data = currentWeekData.days[day] || INITIAL_DAY_DATA;
                                                return (
                                                    <tr key={day} className="hover:bg-slate-50/80 transition-colors">
                                                        <td className="px-4 py-4 font-bold text-slate-700 align-top pt-6">{day}</td>
                                                        
                                                        <td className="px-4 py-4 align-top bg-blue-50/20 space-y-4">
                                                            <div>
                                                                <div className="flex items-center gap-2 mb-1 text-xs font-bold text-blue-600 uppercase">
                                                                    <Icons.Droplets size={12}/> Hydratation
                                                                </div>
                                                                <div className="flex gap-1 flex-wrap">
                                                                    {[1,2,3,4,5,6,7,8].map(i => (
                                                                        <button 
                                                                            key={i} 
                                                                            onClick={() => setHydration(day, i === data.hydration ? i-1 : i)}
                                                                            className={`w-6 h-8 rounded-full border border-blue-200 flex items-end justify-center overflow-hidden drop-anim ${i <= data.hydration ? 'bg-blue-400' : 'bg-white'}`}
                                                                        >
                                                                            <div className={`w-full ${i <= data.hydration ? 'h-full' : 'h-0'} bg-blue-500 transition-all`}></div>
                                                                        </button>
                                                                    ))}
                                                                </div>
                                                            </div>
                                                            <div className="border-t border-blue-100 pt-2">
                                                                <div className="flex items-center gap-2 mb-1 text-xs font-bold text-indigo-600 uppercase">
                                                                    <Icons.Bed size={12}/> Sommeil
                                                                </div>
                                                                <div className="flex gap-2">
                                                                    <div className="flex-1">
                                                                        <input type="number" placeholder="H" value={data.sleep?.hours} onChange={(e) => updateSleep(day, 'hours', e.target.value)} className="w-full text-xs p-1 border rounded text-center"/>
                                                                    </div>
                                                                    <div className="flex-1">
                                                                        <select value={data.sleep?.quality} onChange={(e) => updateSleep(day, 'quality', e.target.value)} className="w-full text-xs p-1 border rounded">
                                                                            <option value="">Qualit√©</option>
                                                                            <option value="1">1/5 üò´</option>
                                                                            <option value="2">2/5 ü•±</option>
                                                                            <option value="3">3/5 üòê</option>
                                                                            <option value="4">4/5 üôÇ</option>
                                                                            <option value="5">5/5 ü§©</option>
                                                                        </select>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </td>

                                                        <td className="px-4 py-4 align-top bg-orange-50/20">
                                                            <div className="space-y-2">
                                                                {data.activities && data.activities.map(act => (
                                                                    <div key={act.id} className="bg-white p-2 rounded border border-orange-200 text-xs shadow-sm flex justify-between items-center group">
                                                                        <div>
                                                                            <span className="font-bold text-slate-700">{act.type}</span>
                                                                            <div className="text-slate-500">{act.duration} min ‚Ä¢ {act.calories} kcal ‚Ä¢ {act.intensity}</div>
                                                                        </div>
                                                                        <button onClick={() => removeActivity(day, act.id)} className="text-red-400 hover:text-red-600 opacity-0 group-hover:opacity-100"><Icons.Trash2 size={14}/></button>
                                                                    </div>
                                                                ))}
                                                                <form onSubmit={(e) => { e.preventDefault(); const form = e.target; const type = form.type.value; const dur = form.duration.value; const cal = form.cal.value; const int = form.int.value; if(type && dur) { addActivity(day, type, dur, cal, int); form.reset(); }}} className="bg-orange-50/50 p-2 rounded border border-orange-100 mt-2">
                                                                    <div className="grid grid-cols-2 gap-2 mb-2">
                                                                        <select name="type" className="text-xs p-1 rounded border border-orange-200">{ACTIVITY_TYPES.map(t => <option key={t} value={t}>{t}</option>)}</select>
                                                                        <input name="duration" type="number" placeholder="Min" className="text-xs p-1 rounded border border-orange-200" required />
                                                                        <input name="cal" type="number" placeholder="Kcal" className="text-xs p-1 rounded border border-orange-200" />
                                                                        <select name="int" className="text-xs p-1 rounded border border-orange-200"><option value="Moyenne">Moyenne</option><option value="Faible">Faible</option><option value="Haute">Haute</option></select>
                                                                    </div>
                                                                    <button type="submit" className="w-full bg-orange-500 text-white text-xs py-1 rounded font-bold hover:bg-orange-600 flex justify-center items-center gap-1"><Icons.Plus size={12}/> Ajouter S√©ance</button>
                                                                </form>
                                                            </div>
                                                        </td>

                                                        <td className="px-4 py-4 align-top bg-indigo-50/20">
                                                            <div className="space-y-1">
                                                                {configSupplements.map(supp => (
                                                                     <label key={supp.id} className="flex items-center gap-2 cursor-pointer select-none">
                                                                        <input type="checkbox" checked={!!data.supplements?.[supp.id]} onChange={() => { const currentVal = currentWeekData.days[day]?.supplements?.[supp.id]; updateDayData(day, 'supplements', !currentVal, supp.id); }} className="w-3 h-3 rounded text-indigo-600 focus:ring-indigo-500" />
                                                                        <span className={`text-[10px] ${data.supplements?.[supp.id] ? 'text-indigo-900 font-bold' : 'text-slate-400'}`}>{supp.name}</span>
                                                                    </label>
                                                                ))}
                                                            </div>
                                                        </td>

                                                        <td className="px-4 py-4 border-l border-slate-100 align-top">
                                                            <div className="space-y-2">
                                                                {configMetrics.map(metric => (
                                                                    <div key={metric.id} className="flex items-center justify-between gap-2">
                                                                        <label className="text-[10px] uppercase text-slate-500 font-bold">{metric.label}</label>
                                                                        <select value={data.metrics?.[metric.id] || ''} onChange={(e) => { const val = e.target.value; updateDayData(day, 'metrics', val, metric.id); }} className="w-12 text-xs p-0.5 rounded border border-slate-200 text-center">
                                                                            <option value="">-</option>
                                                                            {[...Array(11).keys()].map(n => <option key={n} value={n}>{n}</option>)}
                                                                        </select>
                                                                    </div>
                                                                ))}
                                                            </div>
                                                        </td>

                                                        <td className="px-4 py-4 align-top">
                                                            <textarea value={data.notes} onChange={(e) => updateDayData(day, 'notes', e.target.value)} placeholder="..." className="w-full h-24 text-xs p-2 rounded bg-slate-50 border border-slate-200 resize-none"/>
                                                        </td>
                                                    </tr>
                                                );
                                            })}
                                        </tbody>
                                    </table>
                                </Card>
                            </div>
                        )}
                    </main>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
